<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>The Right Notes - Editor</title>
	<link type="text/css" rel="stylesheet" href="/bulma-0.8.2/css/bulma.css">
	<link rel="stylesheet" href="https://cdn.materialdesignicons.com/5.1.45/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
	<link rel="stylesheet" href="editor.css">
	<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
</head>
<body>
<section>
	<div class="container">
		<div class="level">
			<div class="level-item">
				<h2 class="title">The Right Notes - Editor</h2>
			</div>
		</div>
	</div>
</section>
<section>
	<div class="container">
		<div class="columns">
			<div class="column file-list is-one-quarter">
				<div class="panel">
					<p class="panel-heading">
						Articles
					</p>
					<div class="panel-block">
						<div id="file-buttons control">
							<a href="#" id="file-new" title="Create new post" class="button" onclick="newFile()"><span
									class="mdi mdi-file-plus is-primary">New</span></a>
						</div>
					</div>
					<div class="panel-block">
						<div id="file-list">
							<p class="is-loading"><em>Loading...</em></p>
						</div>
					</div>
				</div>

				<div class="panel">
					<p class="panel-heading">
						Composer Portraits
					</p>
					<div class="panel-block">
						<div id="portrait-buttons control">
							<a href="#" id="image-upload" title="Add new portrait" class="button"
							   onclick="uploadPortrait()"><span
									class="mdi mdi-file-plus  is-primary">Upload Portrait</span></a>
						</div>
					</div>
					<div class="panel-block">
						<p>Drag-and-drop an image into the text box to the right to add it to the blog post.</p>
					</div>
					<div class="panel-block">
						<div id="image-gallery">
							<p class="is-loading"><em>Fetching composer portraits...</em></p>
						</div>
					</div>
				</div>
			</div>

			<div class="column is-three-quarters">
				<p class="is-large" id="welcome-message">&lt;-- Choose a file from the list, or click 'New' to start a
					post</p>
				<div id="editor">
					<form id="form-md" class="is-hidden">
						<div id="post-actions" class="level">
							<div class="level-left">
								<a href="#" id="btn-release-edit" class="button mdi mdi-file-document-edit">Edit</a>
							</div>
							<div class="level-right">
								<a href="#" id="btn-release-draft" class="button mdi mdi-clipboard-check" title="Mark this as ready to be published, i.e. no longer a draft." onclick="releaseDraft();">Release Draft</a>
							</div>
						</div>
						<fieldset class="meta-data">
							<div class="field is-horizontal">
								<div class="field">
									<div class="field-label"><label for="form-meta-title" class="label">Title</label>
									</div>
									<div class="control">
										<input type="text" name="form-meta-title" id="form-meta-title"
											   placeholder="title"
											   required
											   class="input" disabled/>
									</div>
								</div>
								<div class="field">
									<div class="field-label">
										<label for="form-meta-slug" class="label">URL</label>
									</div>
									<div class="control">
										<input type="text" name="form-meta-slug" id="form-meta-slug" placeholder="url"
											   class="input" disabled/>
									</div>
								</div>
							</div>
							<div class="field"><label for="form-meta-summary" class="label">Front page summary</label>
								<input type="text" name="form-meta-summary" id="form-meta-summary" placeholder="summary"
									   class="input" disabled/>
							</div>
							<div class="field"><label for="form-meta-playlist" class="label">Spotify playlist</label>
								<input type="text" name="form-meta-playlist" id="form-meta-playlist"
									   placeholder="6sDTNORdmU5Mg7nO0We6q9" class="input" disabled/>
							</div>

							<div class="field is-horizontal">
								<div class="field">
									<div class="field-label"><label for="form-meta-composers"
																	class="label">Composers</label>
									</div>
									<input type="text" name="form-meta-composers" id="form-meta-composers"
										   placeholder="composers"
										   class="input" disabled/>
								</div>
								<div class="field">
									<div class="field-label">
										<label for="form-meta-genres" class="label">Genres</label>
									</div>
									<input type="text" name="form-meta-genres" id="form-meta-genres"
										   placeholder="genres"
										   class="input" disabled/>
								</div>
							</div>

						</fieldset>
						<fieldset class="markdown-text">
							<div class="field">
								<textarea title="form-md-text" id="form-md-text"
										  placeholder="Markdown goes here" cols="120"
										  rows="30" class="textarea" ondrop="drop_handler(event)"
										  ondragover="dragover_handler(event);">
							</textarea></div>

						</fieldset>
					</form>
				</div>
			</div>
		</div>
	</div>
</section>


<!-- modals go here -->
<!-- new post wizard -->
<div id="new-post-modal" class="modal">
	<div class="modal-background"></div>
	<div class="modal-card">
		<header class="modal-card-head">
			<p class="modal-card-title">New Post</p>
			<button class="delete" aria-label="close" onclick="closeModal('new-post-modal');"></button>
		</header>
		<section class="modal-card-body">
			<form id="new-post-form" name="new-post-form">
				<fieldset id="new-post-basics" class="is-active">
					<div class="field">
						<label for="new-post-title">Title</label>
						<div class="control">
							<input type="text" name="title" id="new-post-title"
								   onkeyup="generateSlug('new-post-slug-url-view');"
								   placeholder="title" data-validator="validate_newPostForm_title()">
							<p class="help is-hidden">hidden help</p>
						</div>
					</div>
					<p class="is-small">Website URL will be:<br/> https://www.therightnotes.org/<strong><span
							id="new-post-slug-url-view"></span></strong>.html
					</p>
					<input type="hidden" name="slug" id="new-post-slug" placeholder="url">
				</fieldset>

				<fieldset id="new-post-summary-and-spotify" class="is-hidden">
					<div class="field">
						<label for="new-post-summary">Summary</label>
						<div class="control">
							<input type="text" name="summary" id="new-post-summary"
								   placeholder="Summary (max 300 chars?)">
						</div>
					</div>
					<div class="field">
						<label for="new-post-spotify">Spotify Playlist ID</label>
						<div class="control">
							<input type="text" name="playlist" id="new-post-spotify"
								   placeholder="7cfKH6ExfL01NtV4j7VrKy">
							<p class="help">Paste the <em>Spotify URI</em> for the playlist here - from Spotify, open
								the playlist, click on the <em>"..." more</em> circle, then choose Share > Copy Playlist
								URI.</p>
						</div>
					</div>
				</fieldset>

				<fieldset id="new-post-tags" class="is-hidden">
					<div class="field">
						<label for="new-post-genres">Genres</label>
						<div class="control">
							<input type="text" name="genres[]" id="new-post-genres" placeholder="genres">
							<p class="help is-hidden">hidden help</p>
							<p class="hint">A comma-separated list of genres, e.g "rock, pop, new age"</p>
						</div>
					</div>
					<div class="field">
						<label for="new-post-composers">Composers</label>
						<div class="control">
							<input type="text" name="composers[]" id="new-post-composers" placeholder="composers">
							<p class="help is-hidden">hidden help</p>
							<p class="hint">A comma-separated list of composers, e.g "Bach, Carl Nielsen, Maurice
								Ravel"</p>
						</div>
					</div>
				</fieldset>
				<fieldset id="new-post-bodytext" class="is-hidden">
					<div class="field">
						<label for="new-post-text">Text</label>
						<div class="control">
							<textarea name="body" id="new-post-text" placeholder="Paste the text of the post here."
									  cols="60" rows="3"></textarea>
							<p class="help">Just paste the text in. Pressing 'Save' will create a new draft file, ready
								for editing. It will not be published to the website yet.</p>
						</div>
					</div>
				</fieldset>
			</form>
		</section>
		<footer class="modal-card-foot">
			<button class="button is-danger" onclick="closeModal('new-post-modal');">Cancel</button>
			<button class="button" onclick="newFileWizardPrev()" id="new-post-btn-prev"><span
					class="mdi mdi-page-previous">Previous</span></button>
			<button class="button" onclick="newFileWizardNext()" id="new-post-btn-next"><span class="mdi mdi-page-next">Next</span>
			</button>
			<button class="button is-success is-hidden" onclick="saveNewFile('new-post-form')" id="new-post-btn-save">
				<span class="mdi mdi-check">Save</span></button>
		</footer>
	</div>
</div>

<!-- image upload modal -->
<div id="image-upload-modal" class="modal">
	<div class="modal-background"></div>
	<div class="modal-card">
		<header class="modal-card-head">
			<p class="modal-card-title">Upload new Composer Portrait</p>
			<button class="delete" aria-label="close" onclick="closeModal('image-upload-modal');"></button>
		</header>
		<section class="modal-card-body">
			<p>Not implemented yet!</p>
		</section>
		<footer class="modal-card-foot">
			<button class="button is-danger" onclick="closeModal('image-upload-modal');">Cancel</button>
		</footer>
	</div>
</div>
<!-- create spotify modal -->
<div id="create-spotify-links-modal" class="modal">
	<div class="modal-background"></div>
	<div class="modal-card">
		<header class="modal-card-head">
			<p class="modal-card-title">Upload new Composer Portrait</p>
			<button class="delete" aria-label="close" onclick="closeModal('create-spotify-links-modal');"></button>
		</header>
		<section class="modal-card-body">
			<p>Not implemented yet!</p>
		</section>
		<footer class="modal-card-foot">
			<button class="button is-danger" onclick="closeModal('create-spotify-links-modal');">Cancel</button>
		</footer>
	</div>
</div>
<script src="index.js"></script>
<script src="inline-attachment.js"></script>
<script src="codemirror-inline-attachment.js"></script>
<script>
    var simplemde = new SimpleMDE({
        element: document.getElementById("form-md-text"),
        autofocus: true,
        autosave: false,
        spellChecker: false,
        blockStyles: {
            bold: "**",
            italic: "_"
        },
        toolbar: ["bold", "italic", "quote", "link", "|", {
            name: "spotify",
            action: function customFunction(editor) {
                var cm = editor.codemirror;
                var stat = editor.getState(cm);
                var options = editor.options;
                createCustomMarkdown(cm, false, ["\n{.box}\n!S[", "](spotify-uri-goes-here)\n@[](youtube-link-goes-here)\n"], "");
            },
            className: "fa fa-spotify",
            title: "Create music box",
        }, {
            name: "dropcap",
            action: function customFuction(editor) {
                var cm = editor.codemirror;
                var stat = editor.getState(cm);
                var options = editor.options;
                createCustomMarkdown(cm, false, ["\n{.drop-cap}", "\n"], "");
            },
            className: "fa fa-text-height",
            title: "Create drop cap",
        },
            "|", "fullscreen"]
    });

    inlineAttachment.editors.codemirror4.attach(simplemde.codemirror, {
        onFileUploadResponse: function (xhr) {
            var result = JSON.parse(xhr.responseText),
                filename = result[this.settings.jsonFieldName];

            if (result && filename) {
                var newValue;
                if (typeof this.settings.urlText === 'function') {
                    newValue = this.settings.urlText.call(this, filename, result);
                } else {
                    newValue = this.settings.urlText.replace(this.filenameTag, filename);
                }
                var text = this.editor.getValue().replace(this.lastValue, newValue);
                this.editor.setValue(text);
                this.settings.onFileUploaded.call(this, filename);
            }
            return false;
        }
    });
</script>
</body>
</html>
